---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getProducts, getProductBySlug } from '../../../lib/wp';
import { fallbackPaintings } from '../../../lib/fallbackPaintings';
import { slugify } from '../../../lib/slugify';

export const prerender = false;

const { slug } = Astro.params;
const normalizeSlug = (value = '') =>
  value.toLowerCase().replace(/-\d{2,3}x\d{2,3}.*$/i, '').replace(/-+$/g, '');
const humanizeSlug = (value = '') => {
  const cleaned = normalizeSlug(value).replace(/-/g, ' ').trim().toLowerCase();
  if (!cleaned) return 'Woman with Moon';
  const minorWords = new Set(['of', 'the', 'a', 'an', 'and', 'with']);
  return cleaned
    .split(' ')
    .filter(Boolean)
    .map((word, index) => {
      if (index > 0 && minorWords.has(word)) return word;
      return word.charAt(0).toUpperCase() + word.slice(1);
    })
    .join(' ');
};

const paintingsFromWp = (await getProducts(120)).filter(painting => painting.image);
const paintings =
  paintingsFromWp.length > 0
    ? paintingsFromWp
    : fallbackPaintings.map(item => ({ ...item, link: '#!', slug: slugify(item.title) }));

const findPainting = (items: typeof paintings, targetSlug?: string) => {
  if (!targetSlug) return undefined;
  const normalizedTarget = normalizeSlug(targetSlug);
  return items.find(item => {
    const itemSlug = item.slug ?? slugify(item.title);
    return itemSlug === targetSlug || normalizeSlug(itemSlug) === normalizedTarget;
  });
};

let painting = findPainting(paintings, slug);
if (!painting && slug) {
  painting = await getProductBySlug(slug);
}
const normalizedSlug = slug ? normalizeSlug(slug) : '';
if (!painting && normalizedSlug && normalizedSlug !== slug) {
  painting = findPainting(paintings, normalizedSlug) || (await getProductBySlug(normalizedSlug));
}

const fallbackTitle = slug ? humanizeSlug(slug) : 'Woman with Moon';
const paintingTitle = painting?.title ?? fallbackTitle;
const paintingImage = painting?.image ?? paintings[0]?.image ?? '/gallerie/gallerie-virtuelle.png';
const detailText = painting?.description || 'Original artwork.';
const dimensions = painting?.dimensions ?? '—';
const medium = painting?.medium ?? '—';
const certificateSeed = String(painting?.id ?? painting?.slug ?? slug ?? paintingTitle);
const pageTitle = `${paintingTitle} – My Light Gallery Art`;
const description = painting?.description || 'Artwork details available from the gallery.';
const phoneLabel = '+1 (214) 537-6953';
const phoneHref = 'tel:+12145376953';
const email = 'layla@mylightartgallery.com';
const currentUrl = Astro.url?.href ?? '';
const shareUrl = encodeURIComponent(currentUrl);
const shareImage = encodeURIComponent(painting?.image ?? '');
const shareTitle = encodeURIComponent(paintingTitle);
const facebookShare = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}`;
const pinterestShare =
  `https://pinterest.com/pin/create/button/?url=${shareUrl}&media=${shareImage}&description=${shareTitle}`;
const instagramHref = 'https://www.instagram.com/mylightgalleryart/';
---

<BaseLayout lang="en" title={pageTitle} description={description}>
  <div class="rg-artwork-page">
    <section class="rg-artwork-hero">
      <div class="container">
        <a class="rg-back-link" href="/en/exhibitions">← Back to works</a>
      </div>
    </section>

    <section class="rg-artwork-content">
      <div class="container rg-artwork-grid">
        <div class="rg-artwork-images">
          <div class="rg-artwork-visual">
            <span class="rg-artwork-label">Without frame</span>
            {paintingImage ? (
              <img
                src={paintingImage}
                alt={paintingTitle}
                loading="lazy"
                decoding="async"
                data-zoomable
              />
            ) : (
              <div class="rg-artwork-placeholder"></div>
            )}
          </div>
          <div
            class="rg-artwork-visual rg-artwork-certificate"
            id="certificate-panel"
            data-certificate-panel
            data-certificate-seed={certificateSeed}
          >
            <span class="rg-artwork-label">Certificate of Authenticity</span>
            <div class="rg-certificate-controls">
              <label class="rg-certificate-field">
                <span>Collector's name</span>
                <input type="text" placeholder="e.g. Jane Smith" data-certificate-client />
              </label>
              <label class="rg-certificate-field">
                <span>Issue date</span>
                <input type="date" data-certificate-date />
              </label>
              <button type="button" class="rg-certificate-download" data-certificate-download>
                Download certificate as PDF
              </button>
            </div>
            <article class="rg-certificate-card" data-certificate-card>
              <p class="rg-certificate-eyebrow">My Light Art Gallery</p>
              <h2>Certificate of Authenticity</h2>
              <p class="rg-certificate-number">
                No. <span data-certificate-number>COA-00000000-ART-00000</span>
              </p>
              <dl class="rg-certificate-meta">
                <div>
                  <dt>Artist</dt>
                  <dd>Layla Lastra</dd>
                </div>
                <div>
                  <dt>Artwork</dt>
                  <dd>{paintingTitle}</dd>
                </div>
                <div>
                  <dt>Technique</dt>
                  <dd>{medium}</dd>
                </div>
                <div>
                  <dt>Dimensions</dt>
                  <dd>{dimensions}</dd>
                </div>
                <div>
                  <dt>Collector</dt>
                  <dd data-certificate-client-value>To be assigned</dd>
                </div>
                <div>
                  <dt>Issue date</dt>
                  <dd data-certificate-date-value>To be defined</dd>
                </div>
              </dl>
              <p class="rg-certificate-statement">
                This certifies that this piece is an original and unique work, created by Layla Lastra.
                The purchase of the artwork does not transfer copyright or reproduction rights.
              </p>
              <div class="rg-certificate-signatures">
                <div>
                  <p class="rg-signature-name">Layla Lastra</p>
                  <p class="rg-signature-label">Artist's signature</p>
                </div>
                <div>
                  <p class="rg-signature-name">My Light Art Gallery</p>
                  <p class="rg-signature-label">Issuer</p>
                </div>
              </div>
            </article>
          </div>
        </div>

        <aside class="rg-artwork-details">
          <h1>{paintingTitle}</h1>
          <dl class="rg-artwork-specs">
            <div>
              <dt>Details</dt>
              <dd>{detailText}</dd>
            </div>
            <div>
              <dt>Dimensions</dt>
              <dd>{dimensions}</dd>
            </div>
            <div>
              <dt>Technique</dt>
              <dd>{medium}</dd>
            </div>
          </dl>
          <p class="rg-artwork-sale">This artwork is for sale.</p>
          <button
            class="rg-certificate-btn"
            type="button"
            data-certificate-toggle
            aria-controls="certificate-panel"
            aria-expanded="false"
          >
            OCA Certificate
          </button>
          <p class="rg-artwork-contact">
            Send an enquiry or contact us:
            <a href={phoneHref}>{phoneLabel}</a>
            <span aria-hidden="true"> · </span>
            <a href={`mailto:${email}`}>{email}</a>
          </p>
          <div class="rg-artwork-share">
            <span>Share</span>
            <a href={facebookShare} target="_blank" rel="noopener noreferrer" aria-label="Share on Facebook">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M22 12a10 10 0 1 0-11.5 9.9v-7H8.3V12h2.2V9.8c0-2.2 1.3-3.4 3.3-3.4.96 0 2 .17 2 .17v2.2h-1.1c-1.1 0-1.4.68-1.4 1.37V12h2.4l-.38 2.9h-2v7A10 10 0 0 0 22 12Z"/>
              </svg>
            </a>
            <a href={pinterestShare} target="_blank" rel="noopener noreferrer" aria-label="Share on Pinterest">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2a10 10 0 0 0-3.6 19.3c-.05-.8-.1-2 .02-2.9l1.1-4.7s-.3-.6-.3-1.5c0-1.4.8-2.4 1.8-2.4.8 0 1.2.6 1.2 1.3 0 .8-.5 2-.7 3.2-.2 1 .4 1.8 1.5 1.8 1.8 0 3.2-1.9 3.2-4.6 0-2.4-1.7-4.1-4.1-4.1-2.8 0-4.5 2.1-4.5 4.3 0 .9.3 1.8.7 2.3.1.1.1.2.1.4l-.3 1.3c-.1.3-.2.3-.5.2-1.6-.7-2.6-2.9-2.6-4.7 0-3.8 2.8-7.3 8-7.3 4.2 0 7.5 3 7.5 7.1 0 4.2-2.7 7.6-6.4 7.6-1.2 0-2.4-.6-2.8-1.4l-.7 2.6c-.2.9-.8 2-1.2 2.6A10 10 0 0 0 22 12 10 10 0 0 0 12 2Z"/>
              </svg>
            </a>
            <a href={instagramHref} target="_blank" rel="noopener noreferrer" aria-label="Visit Instagram">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 3h10a4 4 0 0 1 4 4v10a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4Zm10 2H7a2 2 0 0 0-2 2v10c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2Zm-5 3.5A3.5 3.5 0 1 1 8.5 12 3.5 3.5 0 0 1 12 8.5Zm0 2A1.5 1.5 0 1 0 13.5 12 1.5 1.5 0 0 0 12 10.5Zm4.5-3.8a1 1 0 1 1-1-1 1 1 0 0 1 1 1Z"/>
              </svg>
            </a>
          </div>
        </aside>
      </div>
    </section>

    <div class="rg-lightbox" aria-hidden="true">
      <button class="rg-lightbox-close" type="button" aria-label="Close">×</button>
      <img alt="" />
      <p class="rg-lightbox-hint">Click the image to zoom in.</p>
    </div>

    <!-- COA auth modal -->
    <div class="rg-coa-modal" id="coa-auth-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="coa-modal-title">
      <div class="rg-coa-modal-box">
        <p class="rg-coa-modal-logo">My Light Art Gallery</p>
        <h2 id="coa-modal-title">Restricted access</h2>
        <p class="rg-coa-modal-sub">The COA certificate is reserved for gallery use only.</p>
        <form id="coa-auth-form" novalidate>
          <label class="rg-coa-field">
            <span>Username</span>
            <input type="text" id="coa-user-input" autocomplete="username" placeholder="layla" required />
          </label>
          <label class="rg-coa-field">
            <span>Password</span>
            <input type="password" id="coa-pass-input" autocomplete="current-password" placeholder="••••••••" required />
          </label>
          <p class="rg-coa-error" id="coa-auth-error" aria-live="polite"></p>
          <button type="submit" class="rg-coa-submit" id="coa-submit-btn">Sign in</button>
          <button type="button" class="rg-coa-cancel" id="coa-cancel-btn">Cancel</button>
        </form>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  const lightbox = document.querySelector('.rg-lightbox');
  const lightboxImage = lightbox?.querySelector('img');
  const lightboxClose = lightbox?.querySelector('.rg-lightbox-close');
  const zoomables = document.querySelectorAll('[data-zoomable]');
  const certificateToggle = document.querySelector('[data-certificate-toggle]');
  const certificatePanel = document.querySelector('[data-certificate-panel]');
  const certificateClientInput = document.querySelector('[data-certificate-client]');
  const certificateDateInput = document.querySelector('[data-certificate-date]');
  const certificateNumberValue = document.querySelector('[data-certificate-number]');
  const certificateClientValue = document.querySelector('[data-certificate-client-value]');
  const certificateDateValue = document.querySelector('[data-certificate-date-value]');
  const certificateDownload = document.querySelector('[data-certificate-download]');
  let zoomed = false;

  const normalizeCertificateToken = value =>
    value
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '')
      .replace(/[^a-zA-Z0-9]+/g, '')
      .toUpperCase();

  const formatCertificateDate = value => {
    if (!value) return 'To be defined';
    const date = new Date(`${value}T12:00:00`);
    if (Number.isNaN(date.getTime())) return 'To be defined';
    return new Intl.DateTimeFormat('en-US', {
      day: '2-digit',
      month: 'long',
      year: 'numeric',
    }).format(date);
  };

  const buildCertificateNumber = (seed, client, dateValue) => {
    const datePart = (dateValue || new Date().toISOString().slice(0, 10)).replace(/-/g, '');
    const tokenSource = `${seed || 'ART'}${client || ''}`;
    const token = (normalizeCertificateToken(tokenSource).slice(0, 6) || 'ART').padEnd(3, 'X');
    const hashSource = `${seed}|${client}|${datePart}`;
    let hash = 0;
    for (let index = 0; index < hashSource.length; index += 1) {
      hash = (hash * 31 + hashSource.charCodeAt(index)) % 100000;
    }
    const serial = String(hash).padStart(5, '0');
    return `COA-${datePart}-${token}-${serial}`;
  };

  const syncCertificate = () => {
    const seed = certificatePanel?.getAttribute('data-certificate-seed') || 'ART';
    const client = certificateClientInput?.value?.trim() || '';
    const issueDate = certificateDateInput?.value || '';
    if (certificateNumberValue) {
      certificateNumberValue.textContent = buildCertificateNumber(seed, client, issueDate);
    }
    if (certificateClientValue) {
      certificateClientValue.textContent = client || 'To be assigned';
    }
    if (certificateDateValue) {
      certificateDateValue.textContent = formatCertificateDate(issueDate);
    }
  };

  const openLightbox = (src, alt) => {
    if (!lightbox || !lightboxImage) return;
    lightboxImage.src = src;
    lightboxImage.alt = alt;
    lightbox.classList.add('is-visible');
    lightbox.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    zoomed = false;
    lightboxImage.classList.remove('is-zoomed');
  };

  const closeLightbox = () => {
    if (!lightbox || !lightboxImage) return;
    lightbox.classList.remove('is-visible');
    lightbox.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';
    zoomed = false;
    lightboxImage.classList.remove('is-zoomed');
  };

  zoomables.forEach(img => {
    img.addEventListener('click', () => openLightbox(img.src, img.alt));
  });

  lightboxClose?.addEventListener('click', closeLightbox);
  lightbox?.addEventListener('click', event => {
    if (event.target === lightbox) {
      closeLightbox();
    }
  });

  lightboxImage?.addEventListener('click', event => {
    event.stopPropagation();
    zoomed = !zoomed;
    lightboxImage.classList.toggle('is-zoomed', zoomed);
  });

  document.addEventListener('keydown', event => {
    if (event.key === 'Escape') {
      closeLightbox();
    }
  });

  // ── COA Auth ──────────────────────────────────────────────
  const COA_TOKEN_KEY = 'coa_auth_token';
  const COA_EXPIRES_KEY = 'coa_auth_expires';
  const authModal = document.getElementById('coa-auth-modal');
  const authForm = document.getElementById('coa-auth-form');
  const authError = document.getElementById('coa-auth-error');
  const authUserInput = document.getElementById('coa-user-input');
  const authPassInput = document.getElementById('coa-pass-input');
  const authSubmitBtn = document.getElementById('coa-submit-btn');
  const authCancelBtn = document.getElementById('coa-cancel-btn');

  const isAuthenticated = () => {
    const token = sessionStorage.getItem(COA_TOKEN_KEY);
    const expires = Number(sessionStorage.getItem(COA_EXPIRES_KEY) || 0);
    return !!token && Date.now() < expires;
  };

  const openModal = () => {
    if (!authModal) return;
    authModal.setAttribute('aria-hidden', 'false');
    authModal.classList.add('is-open');
    document.body.style.overflow = 'hidden';
    authUserInput?.focus();
    if (authError) authError.textContent = '';
  };

  const closeModal = () => {
    if (!authModal) return;
    authModal.setAttribute('aria-hidden', 'true');
    authModal.classList.remove('is-open');
    document.body.style.overflow = '';
  };

  const openCertificatePanel = () => {
    if (!certificatePanel) return;
    certificatePanel.classList.add('is-visible');
    certificateToggle?.setAttribute('aria-expanded', 'true');
    syncCertificate();
    certificatePanel.scrollIntoView({ behavior: 'smooth', block: 'start' });
  };

  certificateToggle?.addEventListener('click', () => {
    if (!certificatePanel) return;
    const isCurrentlyVisible = certificatePanel.classList.contains('is-visible');
    if (isCurrentlyVisible) {
      certificatePanel.classList.remove('is-visible');
      certificateToggle.setAttribute('aria-expanded', 'false');
      return;
    }
    if (isAuthenticated()) {
      openCertificatePanel();
    } else {
      openModal();
    }
  });

  authCancelBtn?.addEventListener('click', closeModal);
  authModal?.addEventListener('click', e => {
    if (e.target === authModal) closeModal();
  });
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape' && authModal?.classList.contains('is-open')) closeModal();
  });

  authForm?.addEventListener('submit', async e => {
    e.preventDefault();
    if (authError) authError.textContent = '';
    if (authSubmitBtn) authSubmitBtn.textContent = 'Verifying...';
    if (authSubmitBtn) (authSubmitBtn as HTMLButtonElement).disabled = true;
    try {
      const res = await fetch('/api/coa-auth', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          user: (authUserInput as HTMLInputElement)?.value?.trim(),
          password: (authPassInput as HTMLInputElement)?.value,
        }),
      });
      const data = await res.json();
      if (data.ok) {
        sessionStorage.setItem(COA_TOKEN_KEY, data.token);
        sessionStorage.setItem(COA_EXPIRES_KEY, String(data.expires));
        closeModal();
        openCertificatePanel();
      } else {
        if (authError) authError.textContent = data.error || 'Incorrect credentials';
      }
    } catch {
      if (authError) authError.textContent = 'Network error. Please try again.';
    } finally {
      if (authSubmitBtn) authSubmitBtn.textContent = 'Sign in';
      if (authSubmitBtn) (authSubmitBtn as HTMLButtonElement).disabled = false;
    }
  });

  // ── Init certificate ──────────────────────────────────────
  const today = new Date();
  const todayIso = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(
    today.getDate()
  ).padStart(2, '0')}`;
  if (certificateDateInput && !certificateDateInput.value) {
    certificateDateInput.value = todayIso;
  }

  syncCertificate();

  certificateClientInput?.addEventListener('input', syncCertificate);
  certificateDateInput?.addEventListener('input', syncCertificate);
  certificateDateInput?.addEventListener('change', syncCertificate);
  certificateDownload?.addEventListener('click', () => {
    if (!isAuthenticated()) { openModal(); return; }
    if (!certificatePanel) return;
    certificatePanel.classList.add('is-visible');
    certificateToggle?.setAttribute('aria-expanded', 'true');
    syncCertificate();
    window.print();
  });
</script>

<style>
  .rg-artwork-page {
    --rg-ink: #1d1a16;
    --rg-muted: #6f675f;
    --rg-line: #d7cfc2;
    --rg-paper: #fbf8f2;
    background:
      radial-gradient(circle at 12% 15%, rgba(255, 255, 255, 0.85), transparent 55%),
      linear-gradient(140deg, rgba(248, 244, 238, 0.96), rgba(231, 222, 210, 0.98));
    color: var(--rg-ink);
    font-family: 'Roboto', sans-serif;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
  }

  .rg-artwork-hero {
    padding: 3.5rem 2rem 0;
  }

  .rg-back-link {
    text-decoration: none;
    color: var(--rg-ink);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-size: 0.75rem;
  }

  .rg-artwork-content {
    padding: 2.5rem 2rem 6rem;
  }

  .rg-artwork-grid {
    display: grid;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    gap: 3rem;
    align-items: start;
  }

  .rg-artwork-images {
    display: grid;
    gap: 2rem;
  }

  .rg-artwork-visual {
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid var(--rg-line);
    padding: 1.5rem;
    box-shadow: 0 18px 40px rgba(40, 30, 20, 0.1);
  }

  .rg-artwork-visual img {
    width: 100%;
    height: auto;
    display: block;
    cursor: zoom-in;
  }

  .rg-artwork-certificate {
    display: none;
  }

  .rg-artwork-certificate.is-visible {
    display: block;
  }

  .rg-certificate-card {
    border: 1px solid rgba(90, 70, 54, 0.45);
    padding: clamp(1.2rem, 2.8vw, 2.1rem);
    color: #2f2821;
    background:
      radial-gradient(circle at 14% 16%, rgba(255, 255, 255, 0.9), transparent 45%),
      linear-gradient(150deg, rgba(255, 255, 255, 0.92), rgba(248, 240, 231, 0.86));
  }

  .rg-certificate-controls {
    display: grid;
    gap: 0.85rem;
    margin-bottom: 1rem;
  }

  .rg-certificate-field {
    display: grid;
    gap: 0.3rem;
  }

  .rg-certificate-field span {
    text-transform: uppercase;
    letter-spacing: 0.16em;
    font-size: 0.65rem;
    color: var(--rg-muted);
  }

  .rg-certificate-field input {
    border: 1px solid var(--rg-line);
    padding: 0.55rem 0.65rem;
    background: rgba(255, 255, 255, 0.88);
    color: var(--rg-ink);
    font: inherit;
    width: 100%;
  }

  .rg-certificate-download {
    border: 1px solid var(--rg-ink);
    background: var(--rg-ink);
    color: #fff;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    font-size: 0.7rem;
    padding: 0.65rem 0.95rem;
    cursor: pointer;
    transition: opacity 0.2s ease;
  }

  .rg-certificate-download:hover {
    opacity: 0.86;
  }

  .rg-certificate-eyebrow {
    margin: 0;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-size: 0.64rem;
    color: var(--rg-muted);
  }

  .rg-certificate-card h2 {
    margin: 0.6rem 0 0.35rem;
    font-family: 'Times New Roman', Times, serif;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: clamp(1.4rem, 3vw, 2rem);
  }

  .rg-certificate-number {
    margin: 0;
    font-size: 0.77rem;
    text-transform: uppercase;
    letter-spacing: 0.16em;
  }

  .rg-certificate-number span {
    font-weight: 700;
  }

  .rg-certificate-meta {
    margin: 1.4rem 0;
    display: grid;
    gap: 0.72rem;
  }

  .rg-certificate-meta div {
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    border-bottom: 1px dashed rgba(90, 70, 54, 0.35);
    padding-bottom: 0.55rem;
  }

  .rg-certificate-meta dt {
    text-transform: uppercase;
    letter-spacing: 0.14em;
    font-size: 0.66rem;
    color: #665d55;
  }

  .rg-certificate-meta dd {
    margin: 0;
    text-align: right;
    font-size: 0.92rem;
  }

  .rg-certificate-statement {
    margin: 0;
    color: #494138;
    line-height: 1.6;
    font-size: 0.9rem;
  }

  .rg-certificate-signatures {
    margin-top: 1.6rem;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.9rem;
  }

  .rg-certificate-signatures > div {
    border-top: 1px solid rgba(90, 70, 54, 0.55);
    padding-top: 0.7rem;
  }

  .rg-signature-name {
    margin: 0 0 0.2rem;
    font-family: 'Times New Roman', Times, serif;
    font-size: 1.05rem;
  }

  .rg-signature-label {
    margin: 0;
    font-size: 0.66rem;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: var(--rg-muted);
  }

  .rg-artwork-label {
    display: inline-block;
    text-transform: uppercase;
    letter-spacing: 0.3em;
    font-size: 0.7rem;
    color: var(--rg-muted);
    margin-bottom: 0.85rem;
  }

  .rg-artwork-placeholder {
    width: 100%;
    height: 360px;
    background: rgba(210, 200, 190, 0.4);
  }

  .rg-artwork-details h1 {
    font-family: 'Times New Roman', Times, serif;
    font-size: clamp(2.2rem, 4vw, 3.2rem);
    letter-spacing: 0.08em;
    margin: 0 0 1.5rem;
    text-transform: uppercase;
  }

  .rg-artwork-specs {
    margin: 0 0 1.5rem;
    display: grid;
    gap: 1rem;
  }

  .rg-artwork-specs div {
    display: flex;
    justify-content: space-between;
    gap: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--rg-line);
  }

  .rg-artwork-specs dt {
    font-size: 0.75rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    font-weight: 600;
  }

  .rg-artwork-specs dd {
    margin: 0;
    color: var(--rg-muted);
    text-align: right;
  }

  .rg-artwork-sale {
    text-transform: uppercase;
    letter-spacing: 0.12em;
    font-weight: 600;
    margin: 0 0 1.25rem;
  }

  .rg-certificate-btn {
    align-self: flex-start;
    margin: 0 0 1.5rem;
    background: transparent;
    border: 1px solid var(--rg-ink);
    color: var(--rg-ink);
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.75rem;
    padding: 0.7rem 1.4rem;
    cursor: pointer;
    transition: background 0.2s ease, color 0.2s ease;
  }

  .rg-certificate-btn:hover {
    background: var(--rg-ink);
    color: #fff;
  }

  .rg-artwork-contact {
    color: var(--rg-muted);
    margin: 0 0 1.75rem;
    line-height: 1.6;
  }

  .rg-artwork-contact a {
    color: var(--rg-ink);
    text-decoration: none;
    border-bottom: 1px solid var(--rg-line);
  }

  .rg-artwork-share {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.7rem;
  }

  .rg-artwork-share a {
    width: 36px;
    height: 36px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    border: 1px solid var(--rg-ink);
    color: var(--rg-ink);
    text-decoration: none;
    transition: background 0.2s ease, color 0.2s ease;
  }

  .rg-artwork-share a:hover {
    background: var(--rg-ink);
    color: #fff;
  }

  .rg-artwork-share svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }

  .rg-lightbox {
    position: fixed;
    inset: 0;
    background: rgba(10, 8, 6, 0.92);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 1.5rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease;
    z-index: 2000;
    padding: 2.5rem;
  }

  .rg-lightbox.is-visible {
    opacity: 1;
    pointer-events: auto;
  }

  .rg-lightbox img {
    width: min(90vw, 1200px);
    max-height: 85vh;
    object-fit: contain;
    cursor: zoom-in;
    transition: transform 0.3s ease;
    box-shadow: 0 28px 80px rgba(0, 0, 0, 0.45);
  }

  .rg-lightbox img.is-zoomed {
    transform: scale(1.6);
    cursor: zoom-out;
  }

  .rg-lightbox-close {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    width: 42px;
    height: 42px;
    border-radius: 999px;
    border: 1px solid rgba(255, 255, 255, 0.6);
    background: transparent;
    color: #fff;
    font-size: 1.5rem;
    cursor: pointer;
  }

  .rg-lightbox-hint {
    color: rgba(255, 255, 255, 0.7);
    text-transform: uppercase;
    letter-spacing: 0.2em;
    font-size: 0.65rem;
    margin: 0;
  }

  @media (max-width: 960px) {
    .rg-artwork-grid {
      grid-template-columns: 1fr;
    }

    .rg-artwork-specs dd {
      text-align: left;
    }
  }

  @media (max-width: 600px) {
    .rg-artwork-visual {
      padding: 1rem;
    }

    .rg-artwork-placeholder {
      height: 240px;
    }

    .rg-artwork-specs div {
      flex-direction: column;
    }

    .rg-certificate-meta div {
      flex-direction: column;
    }

    .rg-certificate-meta dd {
      text-align: left;
    }

    .rg-certificate-signatures {
      grid-template-columns: 1fr;
    }

    .rg-lightbox img.is-zoomed {
      transform: scale(1.2);
    }
  }

  @media print {
    body {
      background: #fff !important;
    }

    body * {
      visibility: hidden;
    }

    .rg-artwork-certificate,
    .rg-artwork-certificate *,
    .rg-certificate-card,
    .rg-certificate-card * {
      visibility: visible;
    }

    .rg-artwork-certificate {
      display: block !important;
      position: fixed;
      inset: 0;
      background: #fff !important;
      border: none !important;
      box-shadow: none !important;
      margin: 0;
      padding: 0;
      z-index: 9999;
      overflow: visible;
    }

    .rg-artwork-label,
    .rg-certificate-controls {
      display: none !important;
    }

    .rg-certificate-card {
      margin: 0;
      min-height: 100vh;
      border: 1px solid #000;
      box-shadow: none;
      padding: 2.4rem;
      background: #fff !important;
    }
  }

  /* ── COA auth modal ──────────────────────────────── */
  .rg-coa-modal {
    position: fixed;
    inset: 0;
    background: rgba(10, 8, 6, 0.78);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
    padding: 1.5rem;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.22s ease;
  }

  .rg-coa-modal.is-open {
    opacity: 1;
    pointer-events: auto;
  }

  .rg-coa-modal-box {
    background:
      radial-gradient(circle at 12% 14%, rgba(255,255,255,0.95), transparent 55%),
      linear-gradient(145deg, #faf7f2, #ede4d8);
    border: 1px solid var(--rg-line);
    box-shadow: 0 28px 70px rgba(20, 15, 10, 0.3);
    padding: clamp(1.8rem, 5vw, 3rem);
    width: 100%;
    max-width: 400px;
  }

  .rg-coa-modal-logo {
    margin: 0 0 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.22em;
    font-size: 0.62rem;
    color: var(--rg-muted);
  }

  .rg-coa-modal-box h2 {
    margin: 0 0 0.3rem;
    font-family: 'Times New Roman', Times, serif;
    font-size: clamp(1.4rem, 3vw, 1.9rem);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .rg-coa-modal-sub {
    margin: 0 0 1.6rem;
    font-size: 0.85rem;
    color: var(--rg-muted);
    line-height: 1.5;
  }

  .rg-coa-field {
    display: grid;
    gap: 0.3rem;
    margin-bottom: 1rem;
  }

  .rg-coa-field span {
    text-transform: uppercase;
    letter-spacing: 0.16em;
    font-size: 0.65rem;
    color: var(--rg-muted);
  }

  .rg-coa-field input {
    border: 1px solid var(--rg-line);
    padding: 0.6rem 0.75rem;
    background: rgba(255,255,255,0.9);
    color: var(--rg-ink);
    font: inherit;
    font-size: 0.95rem;
    width: 100%;
    outline: none;
    transition: border-color 0.18s ease;
  }

  .rg-coa-field input:focus {
    border-color: var(--rg-ink);
  }

  .rg-coa-error {
    margin: 0 0 0.8rem;
    min-height: 1.2em;
    font-size: 0.8rem;
    color: #b04040;
    text-transform: uppercase;
    letter-spacing: 0.1em;
  }

  .rg-coa-submit {
    width: 100%;
    background: var(--rg-ink);
    color: #fff;
    border: 1px solid var(--rg-ink);
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: opacity 0.2s ease;
    margin-bottom: 0.65rem;
  }

  .rg-coa-submit:hover {
    opacity: 0.84;
  }

  .rg-coa-submit:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .rg-coa-cancel {
    width: 100%;
    background: transparent;
    color: var(--rg-muted);
    border: 1px solid var(--rg-line);
    text-transform: uppercase;
    letter-spacing: 0.18em;
    font-size: 0.7rem;
    padding: 0.65rem 1rem;
    cursor: pointer;
    transition: border-color 0.18s ease, color 0.18s ease;
  }

  .rg-coa-cancel:hover {
    border-color: var(--rg-ink);
    color: var(--rg-ink);
  }

  @media print {
    .rg-coa-modal {
      display: none !important;
    }
  }
</style>
